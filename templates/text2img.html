{% extends 'base.html' %}
{% block title %}Text to Image - SDXL Web UI{% endblock %}
{% block content %}
<h2>Text to Image</h2>
<form id="t2i-form">
  <div class="row">
    <label>Prompt</label>
    <textarea name="prompt" placeholder="A cinematic photo of a corgi in space" required></textarea>
  </div>
  <div class="row">
    <label>Negative Prompt</label>
    <input type="text" name="negative_prompt" placeholder="blurry, low quality">
  </div>
  <div class="row grid">
    <div>
      <label>Steps</label>
      <input type="number" name="steps" value="30" min="1" max="100">
    </div>
    <div>
      <label>Guidance</label>
      <input type="number" step="0.1" name="guidance_scale" value="7.0" min="0" max="20">
    </div>
    <div>
      <label>Width</label>
      <input type="number" name="width" value="1024" step="64" min="512" max="1536">
    </div>
    <div>
      <label>Height</label>
      <input type="number" name="height" value="1024" step="64" min="512" max="1536">
    </div>
  </div>
  <button type="submit">Generate</button>
  <a class="quiet-link" href="/">Back</a>
  </form>
  <div class="output" id="t2i-output"></div>
  <script>
    (function(){
      const form = document.getElementById('t2i-form');
      const output = document.getElementById('t2i-output');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        output.innerHTML = '<div class="spinner">Processingâ€¦</div>';
        try {
          const body = new URLSearchParams(new FormData(form));
          const res = await fetch('/api/text2img', { method: 'POST', body });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Request failed');
          output.innerHTML = `<a href="${data.url}" target="_blank"><img src="${data.url}" alt="output"></a>`;
        } catch (err) {
          output.innerHTML = `<div class="error">${err.message}</div>`;
        }
      });
    })();
  </script>
{% endblock %}


